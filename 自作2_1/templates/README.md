# テンプレートシステム ガイド

このディレクトリには、新規テーマ作成時に使用するテンプレートとリファレンスファイルが含まれています。

---

## 📁 ファイル一覧

### `pose_play_template.md`
- **用途**: 新規テーマの`pose_play.yaml`作成時のテンプレート
- **内容**: 連番フォーマット、シーン定義の例、メインプレイリストの構造

### `scene_category_codes.md`
- **用途**: 連番のカテゴリ略称（CC）の定義
- **内容**: 40種類以上のシーンカテゴリとその2文字略称のマッピング

### `scene_outfit_mapping.md` 🆕
- **用途**: シーンタイプごとの推奨服装パラメータのマッピング
- **内容**: 各シーンタイプに対して1つの推奨服装を定義
- **効果**: 一貫性のある服装選択、ランダムな選択を回避

---

## 🔢 連番システム（2段階）

### フォーマット

```
SS_CC_NNN

SS:  シーン順序（01, 02, 03...）
CC:  カテゴリ略称（2文字）
NNN: プロンプト番号（001, 002, 003...）
```

### 例

```yaml
# シーン1: 到着
pose_scene1_arrival:
  - 01_ar_001,1girl,standing,hotel lobby,...
  - 01_ar_002,1girl,looking around,...
  - 01_ar_003,1girl,walking with luggage,...

# シーン2: 客室
pose_scene2_room:
  - 02_rm_001,1girl,sitting,hotel room,...
  - 02_rm_002,1girl,relaxing,...
  - 02_rm_003,1girl,unpacking,...
```

---

## 🎯 使い方

### AIによる自動適用

新規テーマ作成時、AIが自動的に：

1. **ユーザーへの質問**（1〜6）を実施
2. **シーンフロー**を提案
   ```
   Scene 01: 正午 - 旅館到着
   Scene 02: 午後 - 客室
   Scene 03: 夕方 - 温泉準備
   ...
   ```
3. 承認後、**テンプレートに基づいてファイル生成**
4. 各シーンに**自動的に連番付与**
   - Scene 01 → `01_ar_xxx`（ar = arrival）
   - Scene 02 → `02_rm_xxx`（rm = room）
   - Scene 03 → `03_pr_xxx`（pr = prep）

### カテゴリ略称の選択

AIは`scene_category_codes.md`を参照して、シーンの内容に応じて適切な略称を選択します。

**例：**
- "旅館ロビーに到着" → `arrival` → `ar`
- "客室でくつろぐ" → `room` → `rm`
- "温泉に入る" → `onsen` → `on`
- "食事をする" → `dining` → `dn`

---

## ✅ メリット

### 時系列の保証
- シーン順序が連番（01, 02, 03...）で明確
- ランダム生成時も順序が崩れない
- ソートすると自動的に時系列順になる

### 可読性の向上
- `01_ar_001` → "シーン1の到着シーン"と即座に理解できる
- `05_ob_002` → "シーン5の露天風呂シーン"と分かる

### デバッグの容易さ
- プロンプトがどのシーンに属するか一目瞭然
- 時系列のズレをすぐに発見できる

---

## 📚 参考

詳細は以下のドキュメントを参照：
- `../doc/wildcard_rules.md` - 全体のルール
- `../.cursorrules` - AI向けの実装ルール
- `../doc/outfit_system_guide.md` - 服装システムのガイド

---

## 🔄 既存テーマの移行

既存テーマを新しい連番システムに移行する場合：

1. 現在のシーンの順序を確認
2. 時系列順に並べ替え
3. 各シーンに順序番号を付与（01, 02, 03...）
4. `scene_category_codes.md`から適切な略称を選択
5. プロンプトの連番を更新

**注意**: 既存テーマの移行は任意です。新規テーマから適用することを推奨します。

